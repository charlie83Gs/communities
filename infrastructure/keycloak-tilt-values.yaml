# Keycloak values for Tilt/local development

image:
  repository: quay.io/keycloak/keycloak
  tag: "26.3.5"

replicas: 1

command:
  - "/opt/keycloak/bin/kc.sh"

args:
  - "start-dev"
  - "--import-realm"
  - "--health-enabled=true"
  - "--metrics-enabled=true"

extraEnv: |
  # Admin Console
  - name: KEYCLOAK_ADMIN
    valueFrom:
      secretKeyRef:
        name: keycloak-admin
        key: username
  - name: KEYCLOAK_ADMIN_PASSWORD
    valueFrom:
      secretKeyRef:
        name: keycloak-admin
        key: password

  # Database
  - name: KC_DB
    value: postgres
  - name: KC_DB_URL
    valueFrom:
      secretKeyRef:
        name: keycloak-db
        key: url
  - name: KC_DB_USERNAME
    valueFrom:
      secretKeyRef:
        name: keycloak-db
        key: username
  - name: KC_DB_PASSWORD
    valueFrom:
      secretKeyRef:
        name: keycloak-db
        key: password

  # Hostname (development)
  - name: KC_HOSTNAME
    value: localhost
  - name: KC_HOSTNAME_PORT
    value: "8081"
  - name: KC_HOSTNAME_STRICT
    value: "false"
  - name: KC_HOSTNAME_STRICT_HTTPS
    value: "false"

  # HTTP Settings
  - name: KC_HTTP_ENABLED
    value: "true"
  - name: KC_HTTP_PORT
    value: "8080"

  # Proxy settings
  - name: KC_PROXY
    value: edge

  # Features
  - name: KC_FEATURES
    value: persistent-user-sessions

  # Logging
  - name: KC_LOG_LEVEL
    value: info

extraVolumes: |
  - name: realm-import
    configMap:
      name: keycloak-realm

extraVolumeMounts: |
  - name: realm-import
    mountPath: /opt/keycloak/data/import
    readOnly: true

service:
  type: ClusterIP
  port: 8080

ingress:
  enabled: false

livenessProbe:
  httpGet:
    path: /health/live
    port: 8080
    scheme: HTTP
  initialDelaySeconds: 120
  timeoutSeconds: 10
  periodSeconds: 30
  failureThreshold: 5

readinessProbe:
  httpGet:
    path: /health/ready
    port: 8080
    scheme: HTTP
  initialDelaySeconds: 60
  timeoutSeconds: 10
  periodSeconds: 30
  failureThreshold: 3

resources:
  requests:
    cpu: 500m
    memory: 512Mi
  limits:
    cpu: 1000m
    memory: 1Gi

postgresql:
  enabled: false

dbchecker:
  enabled: true
