# Bun configuration for testing and coverage

[test]
# Test coverage configuration
coverage = true
# NOTE: coverageThreshold disabled due to Bun bug #17028 (still present in v1.3.2)
# Bug: Bun applies threshold PER-FILE instead of globally, causing exit code 1
# Current coverage: ~92% functions, ~91% lines (well above 40% target)
# Re-enable when fixed: https://github.com/oven-sh/bun/issues/17028
# coverageThreshold = 40

# Exclude schema files and test files from coverage reports
coverageSkipTestFiles = true
coverageReporter = ["text", "lcov"]

# Exclude files from coverage calculation using glob patterns
coveragePathIgnorePatterns = [
  "**/db/schema/**",
  "**/*.test.ts",
  "**/*.spec.ts",
  "**/tests/**",
  "**/services/images.service.ts"  # Excluded: Cannot mock sharp native module in Bun
]

# Test settings
timeout = 10000  # 10 second timeout for tests
